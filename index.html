<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Typespeed</title>
        <link rel="stylesheet" href="style/style.css" />
        <link rel="stylesheet" href="style/modal.css" />
        <link rel="stylesheet" href="style/snackbar.css" />
        <script src="https://unpkg.com/feather-icons@4.22.1/dist/feather.min.js"></script>
    </head>
    <body>
        <a
            href="https://github.com/umcconnell/typespeed"
            class="github-corner"
            aria-label="View source on GitHub"
            ><svg
                width="80"
                height="80"
                viewBox="0 0 250 250"
                style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
                aria-hidden="true"
            >
                <path
                    d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"
                ></path>
                <path
                    d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
                    fill="currentColor"
                    style="transform-origin: 130px 106px;"
                    class="octo-arm"
                ></path>
                <path
                    d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
                    fill="currentColor"
                    class="octo-body"
                ></path>
            </svg>
        </a>

        <main>
            <canvas id="canvas">
                Sorry. Your Browser does not support the canvas element. Try
                updating your browser.
            </canvas>
            <div class="controls">
                <button class="btn" id="play">
                    <i data-feather="play" aria-hidden="true"></i>
                    <span class="visually-hidden">Start the game</span>
                </button>
                <input
                    type="text"
                    id="input"
                    class="input"
                    placeholder="Type here..."
                    aria-label="Type here"
                />
                <button class="btn" id="highscore">
                    <i data-feather="award" aria-hidden="true"></i>
                    <span class="visually-hidden">Your highscores</span>
                </button>
                <button class="btn" id="info">
                    <i data-feather="info" aria-hidden="true"></i>
                    <span class="visually-hidden">About this project</span>
                </button>
            </div>
        </main>

        <div class="snackbar snackbar--error" id="error"></div>

        <div class="modal" id="gameOver" aria-label="Game Over">
            <div class="modal__content">
                <button class="modal__close modal__close-icon">&times;</button>
                <h2>Game Over!</h2>
                <p>Your score: <span id="gameOverScore"></span></p>
            </div>
        </div>

        <div class="modal" id="highscores" aria-label="Your Highscores">
            <div class="modal__content">
                <button class="modal__close modal__close-icon">&times;</button>
                <h2>Highscores</h2>
                <ul id="highscore-list" class="list--none"></ul>
            </div>
        </div>

        <div class="modal" id="about" aria-label="About this Project">
            <div class="modal__content">
                <button class="modal__close modal__close-icon">&times;</button>
                <h2>About</h2>
                <p>&lt;/&gt; with &hearts; by Ulysse McConnell</p>
                <p>
                    This project was inspired by
                    <a
                        href="https://inventwithpython.com/blog/2012/02/20/i-need-practice-programming-49-ideas-for-game-clones-to-code#typespeed"
                        target="_blank"
                        rel="noreferrer"
                    >
                        inventwithpython.com
                    </a>
                </p>
                <p>
                    Words from
                    <a
                        href="https://noopschallenge.com/challenges/wordbot"
                        target="_blank"
                        rel="noreferrer"
                    >
                        noopschallenge's wordbot
                    </a>
                </p>
                <p>
                    <a
                        href="https://github.com/tholman/github-corners/"
                        target="_blank"
                        rel="noreferrer"
                    >
                        Github ribbon</a
                    >
                    by Tim Holman (<a
                        href="https://github.com/tholman/github-corners/blob/master/license.md"
                        target="_blank"
                        rel="noreferrer"
                        >LICENSE</a
                    >)
                </p>
                <p>
                    <a
                        href="https://github.com/necolas/normalize.css"
                        target="_blank"
                        rel="noreferrer"
                    >
                        Normalize.css</a
                    >
                    by Nicolas Gallagher and Jonathan Neal (<a
                        href="https://github.com/necolas/normalize.css/blob/master/LICENSE.md"
                        target="_blank"
                        rel="noreferrer"
                        >LICENSE</a
                    >)
                </p>
                <p>
                    <a
                        href="https://github.com/umcconnell/modal"
                        target="_blank"
                        rel="noreferrer"
                    >
                        Modal</a
                    >
                    by Ulysse McConnell (<a
                        href="https://github.com/umcconnell/modal/blob/master/LICENSE.md"
                        target="_blank"
                        rel="noreferrer"
                        >LICENSE</a
                    >)
                </p>
            </div>
        </div>

        <script type="module">
            import Modal from "./script/modal.js";
            import showSnackbar from "./script/snackbar.js";
            import {
                setup,
                setupCanvas,
                play,
                pause,
                guessWord
            } from "./script/script.js";
            import { gameEnv } from "./script/config.js";
            import {
                formatHighscore,
                addHighscore,
                errorAnimation
            } from "./script/helpers.js";

            let errorSnackbar = document.getElementById("error"),
                highscores = new Modal("#highscores"),
                highscoreList = document.getElementById("highscore-list"),
                gameOver = new Modal("#gameOver"),
                gameOverScore = document.getElementById("gameOverScore"),
                about = new Modal("#about");

            let playBtn = document.getElementById("play"),
                highscoreBtn = document.getElementById("highscore"),
                aboutBtn = document.getElementById("info"),
                input = document.getElementById("input");

            let canvas = document.getElementById("canvas");

            function fillPlayBtn() {
                let icon = feather.icons[gameEnv.isPaused ? "play" : "pause"];
                icon.attrs["aria-hidden"] = true;

                playBtn.innerHTML = `${icon.toSvg()}<span class="visually-hidden">${
                    gameEnv.isPaused ? "Start" : "Pause"
                } the game</span>`;
            }

            highscoreBtn.addEventListener("click", () => {
                if (localStorage.highscores) {
                    highscoreList.innerHTML = JSON.parse(
                        localStorage.getItem("highscores")
                    )
                        .map(formatHighscore)
                        .map(score => `<li>${score}</li>`)
                        .join("");
                }
                highscores.open();
            });

            aboutBtn.addEventListener("click", () => about.open());

            playBtn.addEventListener("click", () => {
                input.disabled = !gameEnv.isPaused;
                gameEnv.isPaused ? input.focus() || play() : pause();
                fillPlayBtn();
            });

            input.addEventListener("keydown", ({ key }) => {
                if (key === "Enter") {
                    let correct = guessWord(input.value);
                    correct ? (input.value = "") : errorAnimation(input);
                }
            });

            window.addEventListener("resize", () => setupCanvas(canvas));

            feather.replace();

            setup(
                canvas,
                {},
                {
                    error: err => showSnackbar(errorSnackbar, err.message),
                    gameOver: score => {
                        let highscores =
                            JSON.parse(localStorage.getItem("highscores")) ||
                            [];

                        localStorage.setItem(
                            "highscores",
                            JSON.stringify(addHighscore(highscores, score))
                        );

                        fillPlayBtn();

                        gameOverScore.innerText = score;
                        input.value = "";
                        gameOver.open();
                    }
                }
            );
        </script>
    </body>
</html>
